# DIFlow 云同步功能使用指南

## 功能概述

DIFlow 插件现在支持云同步功能，可以将您的 Cursor 规则和 MCP 配置同步到云端，实现多设备间的配置共享。

## 功能特性

- ✅ **用户认证**: 自动获取 Cursor 用户信息进行认证
- ✅ **规则同步**: 支持 Cursor 规则的上传和下载
- ✅ **MCP 同步**: 支持 MCP 服务器配置的云端管理
- ✅ **同步日志**: 详细的同步操作记录
- ✅ **状态管理**: 实时显示同步状态
- ✅ **错误处理**: 友好的错误提示和处理

## 使用步骤

### 1. 启动后端服务

首先需要启动 DIFlow 后端服务：

```bash
cd server
npm install
npm run start:dev
```

服务将在 `http://localhost:3001` 启动。

### 2. 打开云同步界面

1. 在 VS Code 中打开 DIFlow 插件
2. 选择 "Cursor 管理" 功能
3. 点击 "云同步" 标签页

### 3. 用户登录

1. 点击 "登录" 按钮
2. 插件会自动获取您的 Cursor 用户信息
3. 完成认证后显示登录状态

### 4. 同步操作

#### 同步所有数据

- 点击 "同步所有数据" 按钮，一键上传规则和 MCP 配置

#### 单独同步规则

- **上传规则**: 点击 "上传规则到云端"
- **下载规则**: 点击 "从云端下载规则"

#### 单独同步 MCP 配置

- **上传 MCP**: 点击 "上传 MCP 到云端"
- **下载 MCP**: 点击 "从云端下载 MCP"

### 5. 查看同步日志

在同步日志区域可以查看：

- 同步操作的详细记录
- 成功/失败状态
- 错误信息和解决建议

## API 接口

### 用户认证

```
POST /diflow/api/auth
```

### 用户规则管理

```
GET /diflow/api/user/:email/rules
PUT /diflow/api/user/:email/rules
DELETE /diflow/api/user/:email/rules/:ruleId
```

### MCP 服务器管理

```
GET /diflow/api/user/:email/mcps
PUT /diflow/api/user/:email/mcps
DELETE /diflow/api/user/:email/mcps/:serverId
```

## 数据格式

### 规则数据格式

```json
{
  "ruleName": "cursor-rules",
  "ruleContent": "规则内容...",
  "sortOrder": 1
}
```

### MCP 服务器数据格式

```json
{
  "serverName": "服务器名称",
  "command": "启动命令",
  "args": ["参数1", "参数2"],
  "env": { "环境变量": "值" },
  "sortOrder": 1
}
```

## 故障排除

### 常见问题

1. **无法连接到服务器**

   - 确保后端服务已启动
   - 检查端口 3001 是否被占用
   - 确认防火墙设置

2. **登录失败**

   - 确保 Cursor 已正确安装并登录
   - 检查 Cursor 用户信息是否完整

3. **同步失败**
   - 查看同步日志中的错误信息
   - 确认网络连接正常
   - 检查数据格式是否正确

### 调试模式

启用调试模式查看详细日志：

```bash
# 后端调试
cd server
npm run start:debug

# 前端调试
打开浏览器开发者工具查看控制台日志
```

## 安全说明

- 所有 API 请求都使用 JWT 认证
- 用户数据存储在本地内存中（重启后清空）
- 建议在生产环境中使用持久化数据库
- 敏感信息不会被记录在日志中

## 技术架构

### 后端技术栈

- **框架**: NestJS
- **认证**: JWT
- **数据存储**: 内存存储（可扩展为数据库）
- **API**: RESTful

### 前端技术栈

- **框架**: Vue 3 + TypeScript
- **HTTP 客户端**: Axios
- **UI 组件**: Ant Design Vue
- **状态管理**: Vue Composition API

## 更新日志

### v1.2.0 (2024-01-16)

- ✅ 初始云同步功能实现
- ✅ 用户认证系统
- ✅ 规则和 MCP 配置同步
- ✅ 同步日志和状态管理

## 反馈和支持

如果您在使用过程中遇到问题或有改进建议，请：

1. 查看同步日志获取详细错误信息
2. 检查本指南中的故障排除部分
3. 提交 Issue 或联系开发团队

---

**注意**: 当前版本使用内存存储，服务器重启后数据会丢失。生产环境建议配置持久化数据库。
