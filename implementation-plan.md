# DIFlow VS Code 插件实现计划

## 已完成功能

### 1. 基础插件架构搭建 (2024-12-18)

- 完成 VS Code 插件基础架构
- 集成 Vue 3 + TypeScript 前端框架
- 实现 webview 通信机制
- 配置构建和打包流程

### 2. Cursor 检测与集成功能 (2024-12-18)

- 实现 Cursor 安装状态检测
- 支持多平台（Windows、macOS、Linux）
- 添加系统信息获取功能
- 实现 Cursor 应用启动功能

### 3. MCP 服务器管理功能 (2024-12-18)

- 实现 MCP 服务器列表获取
- 支持添加和删除 MCP 服务器
- 配置文件自动检测和管理
- 错误处理和用户反馈

### 4. 用户规则管理功能 (2024-12-18)

- 实现用户规则文件读取
- 支持规则内容编辑和保存
- 自动备份和恢复机制
- 规则验证和格式检查

### 5. 快速聊天功能 (2024-12-18)

- 实现快速打开 Cursor 聊天
- 支持预设消息模板
- 集成到右键菜单和命令面板
- 提供快捷键支持

### 6. UI 界面优化 (2024-12-18)

- 使用 Ant Design Vue 组件库
- 实现响应式布局设计
- 添加加载状态和错误提示
- 优化用户交互体验

### 7. Cursor 检测逻辑优化 (2024-12-19)

- 修复 macOS 系统下的 Cursor 安装检测问题
- 优化配置文件路径检测准确性
- 增强错误处理和日志记录
- 提升检测逻辑的稳定性

### 8. 自定义安装路径功能 (2024-12-19)

- 新增用户自定义 Cursor 安装路径功能
- 提供跨平台路径设置指导
- 实现路径有效性验证
- 支持路径重置和更新

### 9. MCP 和规则获取修复 (2024-12-19)

- 修复 MCP 服务器列表获取失败问题
- 优化规则文件处理逻辑
- 改进配置文件路径检测
- 统一错误处理机制

### 10. Tab 界面布局恢复 (2024-12-19)

- 根据用户反馈恢复原有 Tab 布局
- 重新设计为四个功能标签页：基础信息、规则管理、MCP 管理、快速聊天
- 使用 Ant Design Vue 的 Tabs 组件实现
- 确保响应式标签页切换，保持所有现有功能和样式

### 11. Cursor 管理功能全面修复 (2024-12-19)

- 统一前后端任务名称，解决任务调用不匹配问题
- 优化 MCP 配置路径检测，确保动态更新配置路径
- 增强错误处理和详细日志记录，便于问题排查
- 修复数据格式处理，确保前后端数据传输一致性
- 技术改进：修复前端 Vue 组件中的任务调用名称，优化后端 CursorIntegration 类的路径检测逻辑

### 12. 任务处理器返回格式统一修复 (2024-12-19) - Done

- 统一所有任务处理器的返回格式，确保前后端数据格式一致性
- 修复 `isCursorInstalled`、`getSystemInfo`、`getCursorSettings` 等核心任务的返回格式
- 统一 MCP 相关任务（`getMcpServers`、`addMcpServer`、`removeMcpServer`）的数据结构
- 优化用户规则任务（`getUserRules`、`updateUserRules`）的响应格式
- 增强所有任务处理器的错误处理机制，添加详细的调试日志
- 确保所有任务返回 `{success: boolean, data?: any, error?: string}` 统一格式

### 13. MCP 路径和用户规则修复 (2024-12-19) - Done

- 修复 MCP 配置文件路径检测，正确指向 `~/.cursor/mcp.json` 而不是 `globalStorage` 目录
- 统一用户规则处理格式，`getUserRules` 和 `getCursorSettings` 都返回字符串格式
- 优化 MCP 配置文件查找逻辑，支持多个备用路径检测
- 修复用户规则读取和保存的数据格式不一致问题
- 增强路径检测的日志记录，便于问题排查
- 技术改进：修正了 `findMcpPath` 方法的路径查找逻辑，统一了规则处理的数据格式

## 待实现功能

### 14. 高级配置管理

- 实现插件全局配置管理
- 支持配置导入导出功能
- 添加配置重置和备份机制
- 提供配置验证和修复工具

### 15. 批量操作功能

- 支持批量添加 MCP 服务器
- 实现批量规则导入导出
- 添加批量操作进度显示
- 提供操作撤销和重做功能

### 16. 插件更新和通知系统

- 实现自动更新检查机制
- 添加版本更新通知
- 支持更新日志显示
- 提供手动更新选项

### 17. 性能优化和缓存机制

- 实现配置文件缓存
- 优化大文件处理性能
- 添加懒加载机制
- 提供性能监控工具

### 18. 国际化支持

- 添加多语言支持框架
- 实现中英文界面切换
- 支持自定义语言包
- 提供翻译管理工具

### 19. 测试和文档完善

- 编写单元测试和集成测试
- 完善 API 文档和用户手册
- 添加故障排除指南
- 提供开发者文档

## 技术债务

### 1. 代码重构

- 优化组件结构和代码复用
- 统一错误处理机制
- 改进类型定义和接口设计
- 提升代码可维护性

### 2. 性能优化

- 减少不必要的文件系统操作
- 优化内存使用和垃圾回收
- 改进异步操作处理
- 提升响应速度

### 3. 安全性增强

- 加强输入验证和过滤
- 实现安全的文件操作
- 添加权限检查机制
- 防止潜在的安全漏洞

## 已知问题

### 1. 平台兼容性

- 部分功能在不同操作系统下表现不一致
- 需要进一步测试和优化跨平台支持

### 2. 错误处理

- 某些边缘情况下的错误处理不够完善
- 需要增加更多的异常捕获和处理逻辑

### 3. 用户体验

- 部分操作的反馈不够及时
- 需要优化加载状态和进度显示

## 开发规范

### 1. 代码风格

- 使用 TypeScript 严格模式
- 遵循 ESLint 和 Prettier 规范
- 保持一致的命名约定
- 添加详细的代码注释

### 2. 提交规范

- 使用语义化提交信息
- 每个功能独立提交
- 包含详细的变更说明
- 关联相关的问题和需求

### 3. 测试要求

- 新功能必须包含测试用例
- 保持测试覆盖率在 80% 以上
- 定期运行回归测试
- 修复 bug 时添加对应测试

## 发布计划

### 版本 1.2.0 (当前开发版本)

- ✅ 动态配置检测系统
- ✅ 前端界面现代化
- ✅ 自定义安装路径功能
- ✅ 检测逻辑优化
- ✅ 用户界面美化
- ✅ Tab 界面布局
- 🔄 代码片段管理功能

### 版本 1.3.0

- ChatGPT 集成功能
- 高级批量操作
- 性能优化

### 版本 1.4.0

- 多语言支持
- 高级配置管理
- 完整测试覆盖

## 注意事项

1. 所有新功能都需要经过充分测试
2. 保持向后兼容性
3. 遵循 VS Code 插件开发最佳实践
4. 定期更新依赖包和安全补丁
5. 收集用户反馈并持续改进
