# Cursor 用户信息同步功能使用指南

## 功能概述

DIFlow 插件新增了 Cursor 用户信息显示和同步功能，可以：

- 自动获取并显示 Cursor 用户的登录信息（邮箱、用户名）
- 一键将 Cursor 的规则和 MCP 配置同步到云端
- 支持跨设备的配置同步

## 功能特性

### 🔍 用户信息显示

- **登录状态检测**：自动检测 Cursor 是否已登录
- **用户信息展示**：显示登录用户的邮箱和用户名
- **实时刷新**：支持手动刷新用户登录状态

### ☁️ 云端同步

- **规则同步**：将 Cursor 用户规则同步到云端
- **MCP 配置同步**：将 MCP 服务器配置同步到云端
- **一键操作**：点击同步按钮即可完成所有配置的上传

## 使用步骤

### 1. 打开 Cursor 管理界面

在 VS Code 中：

1. 按 `Ctrl+Shift+P` (Windows/Linux) 或 `Cmd+Shift+P` (macOS) 打开命令面板
2. 输入 "Cursor 设置" 或 "DiFlow.getCursorSettings"
3. 选择对应命令打开 Cursor 管理界面

### 2. 查看用户信息

在 Cursor 管理界面的 **基本信息** 标签页中：

1. 找到 **用户信息** 区域
2. 查看 Cursor 登录状态
3. 如果已登录，会显示用户邮箱和用户名

### 3. 刷新用户信息

如果用户信息显示不正确或需要更新：

1. 点击 **刷新用户信息** 按钮
2. 系统会重新获取 Cursor 的登录状态
3. 更新后的信息会立即显示

### 4. 同步到云端

当 Cursor 已登录且显示用户邮箱时：

1. 点击用户邮箱旁边的 **同步到云端** 按钮
2. 系统会自动：
   - 使用 Cursor 用户邮箱进行云端认证
   - 获取当前的用户规则配置
   - 获取当前的 MCP 服务器配置
   - 将所有配置上传到云端
3. 同步完成后会显示成功提示

## 技术实现

### 后端实现

- **用户信息获取**：通过 `getCursorUserInfo` 任务从 Cursor 配置文件中读取用户信息
- **配置读取**：使用现有的 `getUserRules` 和 `getMcpServers` 任务获取配置
- **云端 API**：调用云端服务的认证和数据同步接口

### 前端实现

- **用户界面**：在基本信息区域新增用户信息显示卡片
- **状态管理**：使用 Vue 3 响应式数据管理用户登录状态
- **API 集成**：通过 `pluginService` 调用云端同步服务

## 数据格式

### 用户信息格式

```typescript
interface CursorUserInfo {
  isLoggedIn: boolean; // 是否已登录
  email: string; // 用户邮箱
  name: string; // 用户名称
}
```

### 同步数据格式

```typescript
// 规则数据
interface UserRule {
  ruleName: string; // 规则名称
  ruleContent: string; // 规则内容
  sortOrder: number; // 排序
}

// MCP 服务器数据
interface McpServer {
  serverName: string; // 服务器名称
  command: string; // 执行命令
  args: string[]; // 命令参数
  env: Record<string, string>; // 环境变量
  sortOrder: number; // 排序
}
```

## 故障排除

### 用户信息无法获取

**问题**：显示"未登录"或无法获取用户信息
**解决方案**：

1. 确保 Cursor 应用已正确安装
2. 在 Cursor 中登录您的账户
3. 点击"刷新用户信息"按钮重新获取

### 同步失败

**问题**：点击同步按钮后显示错误
**解决方案**：

1. 检查网络连接是否正常
2. 确保云端服务正在运行（默认端口 3001）
3. 查看浏览器控制台的错误信息
4. 重新启动 VS Code 和 Cursor

### 配置未同步

**问题**：同步成功但配置未上传
**解决方案**：

1. 确保 Cursor 中有实际的规则和 MCP 配置
2. 检查 Cursor 配置文件路径是否正确
3. 尝试先在规则管理和 MCP 管理中刷新配置

## 安全说明

- **数据传输**：所有 API 请求使用 JWT 令牌进行身份验证
- **数据存储**：用户数据存储在本地云端服务中
- **隐私保护**：仅同步配置数据，不会上传个人文件内容

## 更新日志

### v1.1.1 (2024-01-XX)

- ✅ 新增 Cursor 用户信息显示功能
- ✅ 新增一键同步到云端功能
- ✅ 集成用户认证和数据同步服务
- ✅ 优化用户界面和交互体验

---

**注意**：此功能需要配合云端同步服务使用。请确保按照 `CLOUD_SYNC_GUIDE.md` 中的说明启动后端服务。
